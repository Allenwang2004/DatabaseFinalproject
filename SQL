以下寫SQL 
1. select 發生市區鄉鎮名稱, count(*) from Location where Location.發生市區鄉鎮名稱 = \"{$selectedRegion}\" group by 發生市區鄉鎮名稱 ; // 區域總交通事故

2.天候 
SELECT
    l.發生市區鄉鎮名稱,
    w.天候名稱,
    COUNT(*) AS 事故數量
FROM
    Location l
JOIN
    Weather w ON l.事件編號 = w.事件編號
GROUP BY
    l.發生市區鄉鎮名稱, w.天候名稱; //區域各天候下事故數量，依使用者選定區域再加條件然後group by市區可以刪掉

3.速限
SELECT
    l.發生市區鄉鎮名稱,
    ac.速限_第1當事者,
    COUNT(*) AS 事故數量
FROM
    Location l
JOIN
    AccidentCondition ac ON l.事件編號 = ac.事件編號
GROUP BY
    l.發生市區鄉鎮名稱, ac.速限_第1當事者;//區域各速限下事故數量，依使用者選定區域再加條件然後group by市區可以刪掉

4.傷亡總人數及平均人數
SELECT
    l.發生市區鄉鎮名稱,
    SUM(d.死亡人數_24小時內) AS 總死亡人數_24小時內,
    SUM(d.死亡人數_2_30日內) AS 總死亡人數_2_30日內,
    SUM(d.受傷人數) AS 總受傷人數,
    AVG(d.死亡人數_24小時內) AS 平均死亡人數_24小時內,
    AVG(d.死亡人數_2_30日內) AS 平均死亡人數_2_30日內,
    AVG(d.受傷人數) AS 平均受傷人數
FROM
    Location l
JOIN
    Deaths d ON l.事件編號 = d.事件編號
GROUP BY
    l.發生市區鄉鎮名稱;//區域傷亡數量及平均人數，依使用者選定區域再加條件然後group by市區可以刪掉

5.平均事故處理用時
SELECT
    l.發生市區鄉鎮名稱,
    AVG(
        TIME_TO_SEC(TIMEDIFF(
            STR_TO_DATE(CONVERT(t.結束_事故排除_時間, TIME), '%H%i%s'),
            STR_TO_DATE(CONVERT(t.到場處理時間, TIME), '%H%i%s')
        )) / 60
    ) AS 平均處理用時
FROM
    Location l
JOIN
    Time t ON l.事件編號 = t.事件編號
GROUP BY
    l.發生市區鄉鎮名稱;//區域平均事故處理用時，依使用者選定區域再加條件然後group by市區可以刪掉

6.類型
SELECT
    l.發生市區鄉鎮名稱,
    ac.事故類型及型態子類別名稱,
    COUNT(*) AS 事件數量
FROM
    Location l
JOIN
    AccidentCategory ac ON l.事件編號 = ac.事件編號
GROUP BY
    l.發生市區鄉鎮名稱, ac.事故類型及型態子類別名稱;//區域各類型事故數量，依使用者選定區域再加條件然後group by市區可以刪掉

7.紀錄同一個地方發生的車禍數量
select count(*) as cnt, round(GPS經度,4) as lon,round(GPS緯度,4) as lat
from Location
group by lon,lat
order by cnt desc
limit 50;

8.計算死傷(不重複計算同一事故)
with temp as(
    select distinct d.死亡人數_24小時內,d.死亡人數_2_30日內,d.受傷人數, l.發生市區鄉鎮名稱, t.發生日期, t.到場處理時間
    from Deaths d 
    join Location as l on l.事件編號 = d.事件編號
    join Time as t on t.事件編號 = d.事件編號
)
SELECT
    發生市區鄉鎮名稱,
    SUM(死亡人數_24小時內) AS 事故後24小時內死亡人數,
    SUM(死亡人數_2_30日內+死亡人數_24小時內) AS 事故後30日內死亡人數,
    SUM(受傷人數) AS 總受傷人數,
    AVG(死亡人數_24小時內) AS 平均事故後24小時內死亡人數,
    AVG(死亡人數_2_30日內+死亡人數_24小時內) AS 平均事故後30日內死亡人數,
    AVG(受傷人數) AS 平均受傷人數
from temp
GROUP BY 發生市區鄉鎮名稱;
/*改良後的計算死傷*/
